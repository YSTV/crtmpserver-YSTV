<?xml version="1.0" encoding="utf-8"?>
<!--
    # This comment is generated by WixEdit, the specific commandline
    # arguments for the WiX Toolset are stored here.

    candleArgs: "<projectfile>" -out "<projectname>.wixobj" -dPlatform=x86 <extensions>
    lightArgs: 
-->
<Wix xmlns="http://schemas.microsoft.com/wix/2006/wi">
    <?if $(var.Platform)=x64 ?>
    <?define msiProductId = "9B48F4A8-70A9-46DF-8023-E23974212714" ?>
    <?define productName = "RTMP Server (Improved) $(var.Version) x64" ?>
	<?define fileLocation = "x64\Release" ?>
	<?define vcrLocation = "C:\Program Files (x86)\Common Files\Merge Modules\Microsoft_VC100_CRT_x64.msm" ?>
    <?else ?>
    <?define msiProductId = "4D65D0E3-3DE3-4C47-9A5B-F7575D945FFB" ?>
    <?define productName = "RTMP Server (Improved) $(var.Version) x86" ?>
	<?define fileLocation = "Win32\Release" ?>
	<?define vcrLocation = "C:\Program Files (x86)\Common Files\Merge Modules\Microsoft_VC100_CRT_x86.msm" ?>
    <?endif ?>
    <Product Id="$(var.msiProductId)" Name="$(var.productName)" Language="1033" Version="$(var.Version)" Manufacturer="Michael Cullen" UpgradeCode="4E54FCE9-5376-48F2-9FAB-ED2B145FCACB">
        <Package Description="RTMP Server (improved)" Comments="$(var.productName)" InstallerVersion="300" Compressed="yes" Platform="$(var.Platform)" />
        <Media Id="1" Cabinet="simple.cab" EmbedCab="yes" />
        <Directory Id="TARGETDIR" Name="SourceDir">
            <Directory Id="ProgramFilesFolder" Name="PFiles">
                <Directory Id="RELEASE" Name="RTMP Server">
                    <Component Id="COMMON.DLL" DiskId="1" Guid="207E5870-8E79-41EC-A3E5-6AA5E6573E62">
                        <File Id="COMMON.DLL" Name="common.dll" Source="$(var.fileLocation)\common.dll" />
                    </Component>
                    <Component Id="COMMON.PDB" DiskId="1" Guid="4495F4D5-F1AF-48F9-B58A-7A675E1BF8E5">
                        <File Id="COMMON.PDB" Name="common.pdb" Source="$(var.fileLocation)\common.pdb" />
                    </Component>
                    <Component Id="CRTMPSERVER.EXE" DiskId="1" Guid="6C63BD6E-5CB7-4365-A30C-00E6A4182531">
                        <File Id="CRTMPSERVER.EXE" Name="crtmpserver.exe" Source="$(var.fileLocation)\crtmpserver.exe">
                            <Shortcut Id="desktopShortcut" Directory="DesktopFolder" Name="RTMP Server" WorkingDirectory="INSTALLDIR" Advertise="yes" Icon="DesktopIcon.exe" IconIndex="0" Arguments="crtmpserver.lua" />
                            <Shortcut Id="ExeShortcut" Directory="ProgramMenuDir" Name="RTMP Server" Advertise="yes" Icon="StartMenuIcon.exe" IconIndex="0" Arguments="crtmpserver.lua" WorkingDirectory="INSTALLDIR" />
                        </File>
                    </Component>
                    <Component Id="CRTMPSERVER.LUA" DiskId="1" Guid="73CDB2CC-8E41-4F3E-ACA2-348A5FFED19C">
                        <File Id="CRTMPSERVER.LUA" Name="crtmpserver.lua" Source="$(var.fileLocation)\crtmpserver.lua" />
                    </Component>
                    <Component Id="CRTMPSERVER.PDB" DiskId="1" Guid="BE38381A-8669-41E8-8F1F-B3F772A0B6DD">
                        <File Id="CRTMPSERVER.PDB" Name="crtmpserver.pdb" Source="$(var.fileLocation)\crtmpserver.pdb" />
                    </Component>
                    <Component Id="LUA.DLL" DiskId="1" Guid="570371D5-BECE-411A-A94D-3BAEC349DFAC">
                        <File Id="LUA.DLL" Name="lua.dll" Source="$(var.fileLocation)\lua.dll" />
                    </Component>
                    <Component Id="LUA.PDB" DiskId="1" Guid="CABD8BDC-BFDD-4F48-81DF-FA2C582556B1">
                        <File Id="LUA.PDB" Name="lua.pdb" Source="$(var.fileLocation)\lua.pdb" />
                    </Component>
                    <Component Id="TESTS.EXE" DiskId="1" Guid="5D4C5A0A-4C16-4D2E-8060-E7D6B1DCD024">
                        <File Id="TESTS.EXE" Name="tests.exe" Source="$(var.fileLocation)\tests.exe" />
                    </Component>
                    <Component Id="TESTS.PDB" DiskId="1" Guid="DB4D22C3-25A0-432B-BDA5-ED38C51E3C6B">
                        <File Id="TESTS.PDB" Name="tests.pdb" Source="$(var.fileLocation)\tests.pdb" />
                    </Component>
                    <Component Id="THELIB.DLL" DiskId="1" Guid="3B5509DB-4CDF-4BCD-980B-F348BE939AE7">
                        <File Id="THELIB.DLL" Name="thelib.dll" Source="$(var.fileLocation)\thelib.dll" />
                    </Component>
                    <Component Id="THELIB.PDB" DiskId="1" Guid="ACFCEF57-8047-4DAF-9C72-ACE308ACD858">
                        <File Id="THELIB.PDB" Name="thelib.pdb" Source="$(var.fileLocation)\thelib.pdb" />
                    </Component>
                    <Component Id="VM.DLL" DiskId="1" Guid="D2F29B96-B0C3-4EF9-8975-D9C53143C7FA">
                        <File Id="VM.DLL" Name="vm.dll" Source="$(var.fileLocation)\vm.dll" />
                    </Component>
                    <Component Id="VM.PDB" DiskId="1" Guid="4948BDEB-26ED-468A-9E90-D98DAC1C1A0A">
                        <File Id="VM.PDB" Name="vm.pdb" Source="$(var.fileLocation)\vm.pdb" />
                    </Component>
                    <Directory Id="APPLICATIONS" Name="applications">
                        <Directory Id="ADMIN" Name="admin">
                            <Component Id="ADMIN.DLL" DiskId="1" Guid="CCFB0A77-6BB6-4D49-945D-6D571FB6CE63">
                                <File Id="ADMIN.DLL" Name="admin.dll" Source="$(var.fileLocation)\applications\admin\admin.dll" />
                            </Component>
                            <Component Id="ADMIN.PDB" DiskId="1" Guid="38BE1025-4C6B-44CF-880E-C4A1D2945308">
                                <File Id="ADMIN.PDB" Name="admin.pdb" Source="$(var.fileLocation)\applications\admin\admin.pdb" />
                            </Component>
                            <Directory Id="MEDIAFOLDER" Name="mediaFolder" />
                        </Directory>
                        <Directory Id="APPSELECTOR" Name="appselector">
                            <Component Id="APPSELECTOR.DLL" DiskId="1" Guid="88601767-6CBE-4A49-BE5F-87CD5472C23F">
                                <File Id="APPSELECTOR.DLL" Name="appselector.dll" Source="$(var.fileLocation)\applications\appselector\appselector.dll" />
                            </Component>
                            <Component Id="APPSELECTOR.PDB" DiskId="1" Guid="3E82C4E2-4715-46F0-AC56-A3C61C339186">
                                <File Id="APPSELECTOR.PDB" Name="appselector.pdb" Source="$(var.fileLocation)\applications\appselector\appselector.pdb" />
                            </Component>
                            <Directory Id="MEDIAFOLDER_1" Name="mediaFolder" />
                        </Directory>
                        <Directory Id="FLVPLAYBACK" Name="flvplayback">
                            <Component Id="FLVPLAYBACK.DLL" DiskId="1" Guid="077A10AA-2C06-495A-9AC7-9F6418297C0D">
                                <File Id="FLVPLAYBACK.DLL" Name="flvplayback.dll" Source="$(var.fileLocation)\applications\flvplayback\flvplayback.dll" />
                            </Component>
                            <Component Id="FLVPLAYBACK.PDB" DiskId="1" Guid="94BFD1A7-A1B8-453C-8306-A430B35CAF6D">
                                <File Id="FLVPLAYBACK.PDB" Name="flvplayback.pdb" Source="$(var.fileLocation)\applications\flvplayback\flvplayback.pdb" />
                            </Component>
                            <Directory Id="MEDIAFOLDER_2" Name="mediaFolder" />
                        </Directory>
                        <Directory Id="PROXYPUBLISH" Name="proxypublish">
                            <Component Id="PROXYPUBLISH.DLL" DiskId="1" Guid="A970309C-96E7-4249-99BB-D40AC47A92C4">
                                <File Id="PROXYPUBLISH.DLL" Name="proxypublish.dll" Source="$(var.fileLocation)\applications\proxypublish\proxypublish.dll" />
                            </Component>
                            <Component Id="PROXYPUBLISH.PDB" DiskId="1" Guid="09976E9B-C859-40A9-9F32-E2BFF165704C">
                                <File Id="PROXYPUBLISH.PDB" Name="proxypublish.pdb" Source="$(var.fileLocation)\applications\proxypublish\proxypublish.pdb" />
                            </Component>
                            <Directory Id="MEDIAFOLDER_3" Name="mediaFolder" />
                        </Directory>
                        <Directory Id="SAMPLEFACTORY" Name="samplefactory">
                            <Component Id="SAMPLEFACTORY.DLL" DiskId="1" Guid="53C77564-C49B-409A-BCAA-505D86E65B66">
                                <File Id="SAMPLEFACTORY.DLL" Name="samplefactory.dll" Source="$(var.fileLocation)\applications\samplefactory\samplefactory.dll" />
                            </Component>
                            <Component Id="SAMPLEFACTORY.PDB" DiskId="1" Guid="AD38EC5B-488F-4117-A543-462612E174BF">
                                <File Id="SAMPLEFACTORY.PDB" Name="samplefactory.pdb" Source="$(var.fileLocation)\applications\samplefactory\samplefactory.pdb" />
                            </Component>
                            <Directory Id="MEDIAFOLDER_4" Name="mediaFolder" />
                        </Directory>
                        <Directory Id="STRESSTEST" Name="stresstest">
                            <Component Id="STRESSTEST.DLL" DiskId="1" Guid="D5AAC348-A6E3-40A0-8A45-A0B7AEA3593C">
                                <File Id="STRESSTEST.DLL" Name="stresstest.dll" Source="$(var.fileLocation)\applications\stresstest\stresstest.dll" />
                            </Component>
                            <Component Id="STRESSTEST.PDB" DiskId="1" Guid="90FB97E2-B8C7-45FB-B6E4-C4686460BC18">
                                <File Id="STRESSTEST.PDB" Name="stresstest.pdb" Source="$(var.fileLocation)\applications\stresstest\stresstest.pdb" />
                            </Component>
                            <Directory Id="MEDIAFOLDER_5" Name="mediaFolder" />
                        </Directory>
                        <Directory Id="VPTESTS" Name="vptests">
                            <Component Id="VPTESTS.DLL" DiskId="1" Guid="49FB4F2C-09AF-4A7C-AACE-72546C98A2EE">
                                <File Id="VPTESTS.DLL" Name="vptests.dll" Source="$(var.fileLocation)\applications\vptests\vptests.dll" />
                            </Component>
                            <Component Id="VPTESTS.PDB" DiskId="1" Guid="B48C0663-C36F-4043-8327-B45CF1A9AD3A">
                                <File Id="VPTESTS.PDB" Name="vptests.pdb" Source="$(var.fileLocation)\applications\vptests\vptests.pdb" />
                            </Component>
                            <Directory Id="MEDIAFOLDER_6" Name="mediaFolder" />
                        </Directory>
                    </Directory>
                    <Merge Id="VCR100" Language="0" SourceFile="$(var.vcrLocation)" DiskId="1" />
                </Directory>
            </Directory>
            <Directory Id="DesktopFolder" />
            <Directory Id="ProgramMenuFolder">
                <Directory Id="ProgramMenuDir" Name="RTMP Server">
                    <Component Id="StartMenuShortcuts" Guid="B3CF5565-20C9-4AA3-AF9A-D6383D12D6E3">
                        <RemoveFolder Id="ProgramMenuDir" On="uninstall" />
                        <Shortcut Id="UninstallProduct" Name="Uninstall" Description="Uninstalls the application" Target="[System64Folder]msiexec.exe" Arguments="/x [ProductCode]" />
                        <RegistryKey Id="RegKeySentinel" Key="Software\Michael Cullen\RTMP Server" Root="HKCU" ForceCreateOnInstall="yes" ForceDeleteOnUninstall="yes">
                            <RegistryValue Type="binary" Value="1" KeyPath="yes" />
                        </RegistryKey>
                    </Component>
                </Directory>
            </Directory>
        </Directory>
        <Feature Id="DefaultFeature" Title="Main Feature" Level="1">
            <ComponentRef Id="COMMON.DLL" />
            <ComponentRef Id="CRTMPSERVER.EXE" />
            <ComponentRef Id="CRTMPSERVER.LUA" />
            <ComponentRef Id="LUA.DLL" />
            <ComponentRef Id="TESTS.EXE" />
            <ComponentRef Id="THELIB.DLL" />
            <ComponentRef Id="VM.DLL" />
            <ComponentRef Id="ADMIN.DLL" />
            <ComponentRef Id="APPSELECTOR.DLL" />
            <ComponentRef Id="FLVPLAYBACK.DLL" />
            <ComponentRef Id="PROXYPUBLISH.DLL" />
            <ComponentRef Id="SAMPLEFACTORY.DLL" />
            <ComponentRef Id="STRESSTEST.DLL" />
            <ComponentRef Id="VPTESTS.DLL" />
            <ComponentRef Id="StartMenuShortcuts" />
            <Feature Id="Symbols" Level="5" Title="Debugging Symbols">
                <ComponentRef Id="COMMON.PDB" />
                <ComponentRef Id="CRTMPSERVER.PDB" />
                <ComponentRef Id="LUA.PDB" />
                <ComponentRef Id="VPTESTS.PDB" />
                <ComponentRef Id="TESTS.PDB" />
                <ComponentRef Id="STRESSTEST.PDB" />
                <ComponentRef Id="THELIB.PDB" />
                <ComponentRef Id="SAMPLEFACTORY.PDB" />
                <ComponentRef Id="PROXYPUBLISH.PDB" />
                <ComponentRef Id="FLVPLAYBACK.PDB" />
                <ComponentRef Id="APPSELECTOR.PDB" />
                <ComponentRef Id="ADMIN.PDB" />
                <ComponentRef Id="VM.PDB" />
            </Feature>
            <MergeRef Id="VCR100" />
        </Feature>
        <UI />
        <UIRef Id="WixUI_FeatureTree" />
        <Icon Id="DesktopIcon.exe" SourceFile="$(var.fileLocation)\crtmpserver.exe" />
        <Icon Id="StartMenuIcon.exe" SourceFile="$(var.fileLocation)\crtmpserver.exe" />
    </Product>
</Wix>